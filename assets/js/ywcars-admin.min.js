jQuery(function(d){var i={init:function(){d(document.body).on("click","button.ywcars_accept_button",this.do_refund),d(document.body).on("click","button#ywcars_offer_coupon_button",this.create_coupon),d(document.body).on("click","button#ywcars_reject_request_button",this.reject),d(document.body).on("click","button#ywcars_processing_request_button",this.processing),d(document.body).on("click","button#ywcars_on_hold_request_button",this.on_hold),d(document.body).on("click","button#ywcars_close_request_button",this.close_request),d(document.body).on("click","#ywcars_submit_message",this.click_submit_message_button),d(document.body).on("submit","#post",this.submit_message),d(document.body).on("click","a.ywcars_update_messages",this.update_messages),d(document.body).on("click",".ywcars_close_alert",function(){d(this).closest("div.ywcars_alert").hide()}),this.check_disabled_buttons(),this.update_table_refund_total(),this.update_table_refund_subtotal(),this.custom_refund()},update_table_refund_total:function(){d(document.body).on("update_refund_total",function(){var a=d("td.ywcars_refund_total_data"),t=d("button span.amount"),e=0;d("input.ywcars_item_total").each(function(a){e+=parseFloat(d(this).val())}),e=accounting.formatNumber(e,ywcars_params.currency_format_num_decimals,""),d("#ywcars_refund_amount").val(e),d(this).trigger("check_disabled_buttons",e),e=accounting.formatMoney(e,{symbol:ywcars_params.currency_format_symbol,decimal:ywcars_params.currency_format_decimal_sep,thousand:ywcars_params.currency_format_thousand_sep,precision:ywcars_params.currency_format_num_decimals,format:ywcars_params.currency_format}),a.text(e),t.text(e)})},update_table_refund_subtotal:function(){var a=d('input[type="number"]'),t=d("input.ywcars_non_line_item_cb");a.change(function(){$row=d(this).closest("tr"),0<d(this).val()?$row.addClass("ywcars_items_table_highlight_single"):$row.removeClass("ywcars_items_table_highlight_single");var a=d("input#ywcars_restock_items"),t=a.closest("span").find("label");d(".ywcars_items_table_highlight_single").length?(a.prop("disabled",!1),t.css("color","#444")):(a.prop("checked",!1),a.prop("disabled",!0),t.css("color","gainsboro"));var e=$row.find("td.ywcars_item_data"),s=d("#ywcars_taxes_enabled").val(),r=parseFloat(e.find("input.ywcars_item_value").val()),c=parseFloat(e.find("input.ywcars_item_tax_value").val()),_=parseInt(e.find("input.ywcars_item_qty").val()),n=s?(r+c)*_:r*_;e.find("input.ywcars_item_total").val(n),$row.find("td.ywcars_refund_subtotal_data").text(accounting.formatMoney(n,{symbol:ywcars_params.currency_format_symbol,decimal:ywcars_params.currency_format_decimal_sep,thousand:ywcars_params.currency_format_thousand_sep,precision:ywcars_params.currency_format_num_decimals,format:ywcars_params.currency_format})),d(this).trigger("update_refund_total")}).change(),t.change(function(){$row=d(this).closest("tr");var a=$row.find("td.ywcars_non_line_item_data"),t=d("#ywcars_taxes_enabled").val(),e=parseFloat(a.find("input.ywcars_item_value").val()),s=parseFloat(a.find("input.ywcars_item_tax_value").val()),r=$row.find("td.ywcars_refund_subtotal_data"),c=0;d(this).is(":checked")?($row.addClass("ywcars_items_table_highlight_single"),c=t?e+s:e,r.text(accounting.formatMoney(c,{symbol:ywcars_params.currency_format_symbol,decimal:ywcars_params.currency_format_decimal_sep,thousand:ywcars_params.currency_format_thousand_sep,precision:ywcars_params.currency_format_num_decimals,format:ywcars_params.currency_format}))):($row.removeClass("ywcars_items_table_highlight_single"),c=0,r.text("")),a.find("input.ywcars_item_total").val(c),d(this).trigger("update_refund_total")}).change(),d("input#ywcars_restock_items").prop("checked",!0)},custom_refund:function(){var r=d(".ywcars_custom_refund_amount"),c=d("button span.amount");r.on("keyup",function(a){var t=d("td.ywcars_refund_total_data"),e=accounting.unformat(r.val(),ywcars_params.mon_decimal_point),e=accounting.formatNumber(e,ywcars_params.currency_format_num_decimals,"");d(this).trigger("check_disabled_buttons",e),d("#ywcars_refund_amount").val(e);var s=accounting.formatMoney(e,{symbol:ywcars_params.currency_format_symbol,decimal:ywcars_params.currency_format_decimal_sep,thousand:ywcars_params.currency_format_thousand_sep,precision:ywcars_params.currency_format_num_decimals,format:ywcars_params.currency_format});c.text(s),t.text(s)})},check_disabled_buttons:function(){d(document.body).on("check_disabled_buttons",function(a,t){var e=d("button.ywcars_request_action_button"),s=d("#ywcars_api_refund_button"),r=d("#ywcars_offer_coupon_button"),c=d("button#ywcars_reject_request_button"),_=d("button#ywcars_processing_request_button"),n=d("button#ywcars_on_hold_request_button"),o=!!d("input#ywcars_request_is_closed").val(),i=d("#ywcars_request_status").val(),u=parseFloat(d("input#ywcars_order_total").val());o||t<=0||u<t?e.prop("disabled",!0):(e.prop("disabled",!1),s.hasClass("disabled")&&s.prop("disabled",!0)),"ywcars-coupon"==i&&r.prop("disabled",!0),"ywcars-rejected"==i&&c.prop("disabled",!0),"ywcars-processing"==i&&_.prop("disabled",!0),"ywcars-on-hold"==i&&n.prop("disabled",!0)}),d(document.body).trigger("check_disabled_buttons")},do_refund:function(a){var t,e,s,r,c,_,n,o;a.preventDefault(),i.block(),window.confirm(ywcars_params.i18n_do_refund)?(t=d("input#ywcars_request_id").val(),e=d("input#ywcars_order_id").val(),s=d("input#ywcars_refund_amount").val(),r=d("input#refunded_amount").val(),c={},_={},n={},d("tr.ywcars_items_table_highlight_single td.ywcars_item_data, tr.ywcars_items_table_highlight_single td.ywcars_non_line_item_data").each(function(a,t){item_id=d(t).find(".ywcars_item_id").val(),item_qty=parseInt(d(t).find(".ywcars_item_qty").val()),item_value=parseFloat(d(t).find(".ywcars_item_value").val()),item_total=item_qty?item_value*item_qty:item_value,item_qty&&(c[item_id]=item_qty),_[item_id]=accounting.unformat(item_total,ywcars_params.mon_decimal_point),n[item_id]={},item_taxes=d(t).find(".ywcars_item_tax").each(function(a,t){var e=d(t).data("tax_id"),s=item_qty?parseFloat(t.value)*item_qty:parseFloat(t.value);n[item_id][e]=accounting.unformat(s,ywcars_params.mon_decimal_point)})}),o={action:"woocommerce_refund_line_items",ywcars_request_id:t,order_id:e,refund_amount:s,refunded_amount:r,refund_reason:"",line_item_qtys:JSON.stringify(c,null,""),line_item_totals:JSON.stringify(_,null,""),line_item_tax_totals:JSON.stringify(n,null,""),api_refund:d(this).is(".do-api-refund"),restock_refunded_items:d("#ywcars_restock_items:checked").length?"true":"false",security:ywcars_params.order_item_nonce},d.post(ywcars_params.ajax_url,o,function(a){!0===a.success?(i.unblock(),window.location.reload()):(window.alert(a.data.error),i.unblock())})):i.unblock()},create_coupon:function(a){a.preventDefault(),i.block();var t,e=d("input#ywcars_request_id").val(),s=d("input#ywcars_refund_amount").val(),r=accounting.formatMoney(s,{symbol:ywcars_params.currency_format_symbol,decimal:ywcars_params.currency_format_decimal_sep,thousand:ywcars_params.currency_format_thousand_sep,precision:ywcars_params.currency_format_num_decimals,format:ywcars_params.currency_format});window.confirm(ywcars_params.create_coupon+" "+r)?(t={action:"ywcars_create_coupon",ywcars_request_id:e,amount:s,security:ywcars_params.create_coupon_nonce},d.post(ywcars_params.ajax_url,t,function(a){!0===a.success?(i.unblock(),window.location.href):(window.alert(a.data.error),i.unblock())})):i.unblock()},reject:function(a){a.preventDefault(),i.block();var t,e=d("input#ywcars_request_id").val();window.confirm(ywcars_params.reject)?(t={action:"ywcars_change_status",ywcars_request_id:e,ywcars_status:"ywcars-rejected",security:ywcars_params.change_status_nonce},d.post(ywcars_params.ajax_url,t,function(a){!0===a.success?(i.unblock(),window.location.href):(window.alert("Error: "+a.data.error),i.unblock())})):i.unblock()},processing:function(a){a.preventDefault(),i.block();var t={action:"ywcars_change_status",ywcars_request_id:d("input#ywcars_request_id").val(),ywcars_status:"ywcars-processing",security:ywcars_params.change_status_nonce};d.post(ywcars_params.ajax_url,t,function(a){!0===a.success?(i.unblock(),window.location.href):(window.alert("Error: "+a.data.error),i.unblock())})},on_hold:function(a){a.preventDefault(),i.block();var t={action:"ywcars_change_status",ywcars_request_id:d("input#ywcars_request_id").val(),ywcars_status:"ywcars-on-hold",security:ywcars_params.change_status_nonce};d.post(ywcars_params.ajax_url,t,function(a){!0===a.success?(i.unblock(),window.location.href):(window.alert("Error: "+a.data.error),i.unblock())})},close_request:function(a){a.preventDefault(),i.block();var t,e=d("input#ywcars_request_id").val();window.confirm(ywcars_params.close_request)?(t={action:"ywcars_change_status",ywcars_request_id:e,ywcars_status:"ywcars-close-request",security:ywcars_params.change_status_nonce},d.post(ywcars_params.ajax_url,t,function(a){!0===a.success?(i.unblock(),window.location.href):(window.alert("Error: "+a.data.error),i.unblock())})):i.unblock()},click_submit_message_button:function(a){a.preventDefault();d("#post").trigger("submit",!0)},submit_message:function(a){var t,s=d("textarea#ywcars_new_message"),e=d("input#ywcars_request_id").val();s.val()&&e?(a.preventDefault(),form_data=new FormData(this),form_data.append("action","ywcars_submit_message"),form_data.append("security",ywcars_params.ywcars_submit_message),form_data.append("request_id",e),t={type:"POST",url:ywcars_params.ajax_url,data:form_data,success:function(a,t,e){a.success&&"ywcars_message_submitted_correctly"==a.data?(d("div.ywcars_success_alert").show().find("span.ywcars_alert_content").text(ywcars_params.success_message),s.val("")):d("div.ywcars_error_alert").show().find("span.ywcars_alert_content").text(a.data)},error:function(a,t,e){d("div.ywcars_error_alert").show().find("span.ywcars_alert_content").text(e)},complete:function(){i.unblock_messages(),i.update_messages(a)},cache:!1,contentType:!1,processData:!1},i.block_messages({message:null,overlayCSS:{background:"#fff",opacity:.6}}),d.ajax(t)):d("div.ywcars_error_alert").show().find("span.ywcars_alert_content").text(ywcars_params.fill_fields)},update_messages:function(a){a.preventDefault();var t,e=d("input#ywcars_request_id").val(),s=d("div.ywcars_messages_history_frame");e&&(t={action:"ywcars_update_messages",security:ywcars_params.ywcars_update_messages,request_id:e},i.block_messages({message:null,overlayCSS:{background:"#fff",opacity:.6}}),d.post(ywcars_params.ajax_url,t,function(a){s.empty(),s.prepend(a),i.unblock_messages()}))},block:function(){d("#ywcars-items-metabox").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){d("#ywcars-items-metabox").unblock()},block_messages:function(){d("#ywcars-messages-metabox").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock_messages:function(){d("#ywcars-messages-metabox").unblock()}},e={init:function(){d(document.body).on("woocommerce_variations_loaded",this.on_variations),d("input.ywcars_ndays_radio").change({selector:"._ywcars_ndays_refund_field"},e.hide_fields_on_radio_group).change(),d("input.ywcars_message_radio").change({selector:"._ywcars_message_field"},e.hide_fields_on_radio_group).change()},on_variations:function(){d(".ywcars_refunds_product_variations_data").each(function(a,t){d(t).find("input.ywcars_ndays_radio").change({selector:"._ywcars_ndays_refund_variation_field"},e.hide_fields_on_radio_group),d(t).find("input.ywcars_message_radio").change({selector:"._ywcars_message_variation_field"},e.hide_fields_on_radio_group)})},hide_fields_on_radio_group:function(a){var t=d(a.data.selector);"custom"==d(this).filter(":checked").val()?t.show():t.hide()}},a=function(){d(".ywcars_requests_toggle_button").on("click",function(a){a.preventDefault(),d(this).closest(".ywcars_requests_wrapper").find(".ywcars_single_request").not(".first").toggle(400)})};i.init(),e.init(),a()});